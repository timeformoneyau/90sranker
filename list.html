<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Movie Lists</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>📋 Your Lists</h1>

    <h2>Ranked Movies</h2>
    <ol id="ranking-list"></ol>

    <h2>Haven’t Seen List</h2>
    <ul id="unseen-list"></ul>

    <h2>Tagged Movies</h2>
    <ul id="tagged-list"></ul>

    <a href="index.html" style="color: #66ccff; text-decoration: underline; font-size: 1.1em; display: block; margin-top: 2em;">⬅️ Back to Voting</a>
  </div>

  <script>
    let movies = [];
    let ratings = JSON.parse(localStorage.getItem("movieRatings")) || {};
    let unseen = JSON.parse(localStorage.getItem("unseenMovies")) || [];
    let tags = JSON.parse(localStorage.getItem("movieTags")) || {};

    async function loadLists() {
      const response = await fetch("movie_list_cleaned.json");
      movies = await response.json();
      updateRanking();
      updateUnseenList();
      updateTaggedList();
    }

   function updateRanking() {
  const listEl = document.getElementById("ranking-list");
  listEl.innerHTML = "";

  const ranked = [...movies]
    .filter(m => ratings[m.title] !== undefined && !unseen.includes(m.title))
    .sort((a, b) => (ratings[b.title] || 1000) - (ratings[a.title] || 1000));

  ranked.forEach(movie => {
    const rating = ratings[movie.title] || 1000;
    const record = stats[movie.title] || { wins: 0, losses: 0 };
    const total = record.wins + record.losses;
    const winRate = total > 0 ? ((record.wins / total) * 100).toFixed(1) + "%" : "–";

    const li = document.createElement("li");
    li.innerHTML = `
      <strong>${movie.title}</strong> (${movie.year}) — 
      <span>${rating} pts</span> | 
      <span>W: ${record.wins}</span>, 
      <span>L: ${record.losses}</span>, 
      <span>Win%: ${winRate}</span>
    `;
    listEl.appendChild(li);
  });
}

    function updateUnseenList() {
      const unseenList = document.getElementById("unseen-list");
      unseenList.innerHTML = "";

      unseen.forEach(title => {
        const li = document.createElement("li");
        li.textContent = title + " ";
        const button = document.createElement("button");
        button.textContent = "Put Back";
        button.onclick = () => {
          unseen = unseen.filter(t => t !== title);
          localStorage.setItem("unseenMovies", JSON.stringify(unseen));
          updateUnseenList();
          updateRanking();
        };
        li.appendChild(button);
        unseenList.appendChild(li);
      });
    }

    function updateTaggedList() {
      const taggedList = document.getElementById("tagged-list");
      taggedList.innerHTML = "";

      Object.keys(tags).forEach(title => {
        const movie = movies.find(m => m.title === title);
        if (!movie || !tags[title].length) return;

        const li = document.createElement("li");
        li.innerHTML = `<strong>${movie.title}</strong> (${movie.year}) — ${tags[title].join(", ")}`;
        taggedList.appendChild(li);
      });
    }

    window.onload = loadLists;
  </script>
</body>
</html>
